{"version":3,"sources":["modules/UI/Overlay.tsx","common/states.ts","resources/catalogs/Materials.tsx","resources/catalogs/Textures.ts","resources/catalogs/Shaders.ts","samples/BasicDemo.tsx","resources/assets/img/sand.jpg","resources/assets/img/sand_norm.png","modules/helpers/BoxEntityCtrlHlp.tsx","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","modules/tools/BoxUtils.ts","samples/BoxSplitDemo.tsx"],"names":["InfoOverlay","sample","console","log","name","caseNb","className","id","CaseSelector","items","current","onSelect","value","onChange","evt","target","Object","keys","map","key","create","set","get","time","custom","Date","controls","setTime","customTime","setControls","ctrl","useSampleStates","CATALOG","textureLoader","THREE","buildTex","texImg","repeat","load","wrapS","wrapT","anisotropy","sand_norm","img_sand_norm","Color","uniforms","vertexShader","join","fragmentShader","Material","props","WATER","attach","opacity","transparent","color","SAND","side","metalness","bumpScale","img_sand","normalMap","TextureCatalog","SHADCOL","Shaders","extend","OrbitControls","TransformControls","Wrapper","gl","useThree","setClearColor","shadowMap","enabled","type","Controls","orbitRef","useRef","camera","state","useFrame","update","useEffect","ref","args","domElement","enableDamping","dampingFactor","rotateSpeed","MoveCtrl","object","transfCtrl","onMove","event","matrix","addEventListener","detach","removeEventListener","Lights","lt","clock","getElapsedTime","position","x","Math","sin","z","cos","intensity","angle","penumbra","castShadow","Helpers","size","Static","grp","plane","rotation-x","PI","receiveShadow","push","Moveable","useState","isSelected","setIsSelected","isSelectedRef","cubeRef","onClick","useCallback","e","stopPropagation","cubeMesh","useMemo","moveCtrl","gl2","module","exports","BOX_SELECT_MODES","defaultStyle","default","alpha","ghostColor","ghostAlpha","hovered","selected","BoxEntityCtrlHlp","boxEnt","boxStyle","isHovered","setIsHovered","boxRef","ghostRef","boxDim","Vector3","box","getSize","boxCenter","getCenter","style","assign","onHover","setFromObject","onPointerUp","onPointerOver","onPointerOut","onWheel","toArray","_defineProperties","i","length","descriptor","enumerable","configurable","writable","defineProperty","BoxSplitter","rejected","Constructor","protoProps","staticProps","combination","targetVol","volume","reduce","sizeSum","y","round","this","checkDuplicate","candidates","volumeTarget","level","valid","filter","findIndex","box2","containsBox","clone","expandByScalar","intersectsBox","validBoxes","validBox","find","makeCombinations","checkValidity","intersectBox","min","combinationArr","combin2","dupe","forEach","found","equals","intersectBoxes","overlapBox","boxPts","pts","max","flat","arr","p","index","p2","splice","boxes","slice","Box3","expandByPoint","vol","emptySpace","volDiff","combinationCandidates","combin","sort","g1","g2","res","prototype","StaticBoxStyle","MovingBoxStyle","OverlapBoxStyle","SplitBoxesStyle","orig","orig2","dim","dim2","staticBox","movingBox","add","AnimationWidget","toLocaleTimeString","Main","clk","anim","splitBoxes","setSplitBoxes","staticBoxEnt","movingBoxEnt","mat","applyMatrix4","setFromCenterAndSize","intersect","split","realTime","date","setHours","floor","setMinutes","Matrix4","statBoxCenter","movBoxCenter","t","getHours","getMinutes","makeTranslation","window","code","helpers","splitBoxHelpers","ent"],"mappings":"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","file":"static/js/5.7cd7db9c.chunk.js","sourcesContent":["import React from \"react\"\nimport { useSampleStates } from \"../../common/states\";\nimport './UI.css'\n\n/**\n * An overlay to display basic information\n */\nexport const InfoOverlay = ({ sample }: { sample: any }) => {\n    console.log(\"Sample: %s %s\", sample.name, sample.caseNb ? \"#\" + sample.caseNb : \"\");\n\n    return (<>\n        <div className=\"overlay\" id=\"info\">\n            <span >\n                {sample.name}\n            </span>\n        </div>\n    </>)\n}\n\n/**\n * A dropdown menu to select a sample case (e.g. test case)\n * @param param0 case options + current caseId\n * export sample.caseNb in states\n */\nexport const CaseSelector = ({ items, current, onSelect}: { items: any, current: number, onSelect: any }) => {\n    // const setSample = useSampleStates(state => state.setSample);\n\n    return (<>\n        <div className=\"overlay inputBtn\" id=\"caseSelector\">\n            <select id=\"testCases\" value={current} onChange={evt => onSelect(evt.target.value)}>\n                {Object.keys(items).map((key) =>\n                    <option key={key} value={key}>{items[key]}</option>\n                )}\n            </select>\n        </div>\n    </>)\n}","import create from \"zustand\";\n// import { stateContext } from \"react-three-fiber\";\n\nconst [useSampleStates] = create((set, get) => ({\n    time: {\n        custom: new Date()\n    },\n    controls: {\n    },\n    setTime: (customTime: any) => { set({ ...get(), time: { custom: customTime } }) },\n    setControls: (ctrl: any) => set({ ...get(), controls: ctrl })\n}))\n\nexport { useSampleStates };","import React from \"react\";\nimport * as THREE from \"three\";\nimport * as TextureCatalog from \"./Textures\";\nimport * as Shaders from './Shaders';\nexport enum CATALOG {\n  WATER,\n  SAND,\n  SHADCOL\n}\nexport type MaterialProps = {\n  name: CATALOG,\n  repeat: number\n}\nexport function Material(props: MaterialProps) {\n  switch (props.name) {\n    case CATALOG.WATER:\n      return (\n        <meshStandardMaterial\n          attach=\"material\"\n          opacity={0.5}\n          transparent={true}\n          color={0xff0000}\n        />);\n    case CATALOG.SAND:\n      return (\n        <meshStandardMaterial\n          attach=\"material\"\n          opacity={0.5}\n          transparent={false}\n          color={0xffffff}\n          side={THREE.DoubleSide}\n          metalness={0.2}\n          bumpScale={0.0005}\n          map={TextureCatalog.sand(props.repeat)}\n          normalMap={TextureCatalog.sand_norm(props.repeat)}\n        />);\n    case CATALOG.SHADCOL:\n      return (<shaderMaterial\n        attach=\"material\"\n        vertexShader={Shaders.Color.vertexShader}\n        fragmentShader={Shaders.Color.fragmentShader}\n      />)\n  }\n}\n","import * as THREE from 'three';\nimport img_sand from '../assets/img/sand.jpg';\nimport img_sand_norm from '../assets/img/sand_norm.png';\n\nvar textureLoader = new THREE.TextureLoader();\n\nvar buildTex = (texImg: string, repeat: number) => {\n    return textureLoader.load(texImg, (map: THREE.Texture) => {\n        map.wrapS = THREE.RepeatWrapping;\n        map.wrapT = THREE.RepeatWrapping;\n        map.anisotropy = 4;\n        map.repeat.set(repeat, repeat);\n        return map;\n    });\n}\n\nvar sand = (repeat: number) => { return buildTex(img_sand, repeat) };\nvar sand_norm = (repeat: number) => { return buildTex(img_sand_norm, repeat) };\n\nexport {sand, sand_norm};","// import { Vector4, Uniform } from \"three/build/three.module\";\n// import * as TextureCatalog from \"./TextureCatalog\";\n\nvar Color = {\n\n    uniforms: {\n    },\n\n    vertexShader: [\n        \"attribute vec3 color;\",\n        \"varying vec3 col;\",\n        \"void main()\",\n        \"{\",\n        \"   col = color;\",\n        \"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\",\n        \"\tgl_Position = projectionMatrix * mvPosition;\",\n        \"}\"\n    ].join(\"\\n\"),\n\n    fragmentShader: [\n        \"in vec3 col;\",\n        \"void main( void ) {\",\n        \"\tgl_FragColor = vec4(col.r,col.g,col.b,1.0);\",\n        \"}\"\n    ].join(\"\\n\")\n\n};\n\nexport { Color};\n","///<reference path=\"../dts/misc-types-extend.d.ts\" />\nimport React, { useRef, useEffect, useCallback, useState, useMemo } from \"react\";\nimport * as THREE from \"three\";\nimport { useFrame, extend, useThree, Canvas } from \"react-three-fiber\";\nimport { Material, CATALOG } from \"../resources/catalogs/Materials\";\nimport { useSampleStates } from \"../common/states\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls\";\nimport { TransformControls } from \"three/examples/jsm/controls/TransformControls\";\nimport { InfoOverlay } from \"../modules/UI/Overlay\";\n\ndeclare global {\n    // eslint-disable-next-line @typescript-eslint/no-namespace\n    namespace JSX {\n        interface IntrinsicElements {\n            orbitControls: any;\n            transformControls: any;\n        }\n    }\n}\n\nextend({ OrbitControls })\nextend({ TransformControls })\n\nexport const Wrapper = (props: any) => {\n    const {\n        gl,                           // WebGL renderer\n        // scene,                        // Default scene\n        // camera,                       // Default camera\n        // size,                         // Bounds of the view (which stretches 100% and auto-adjusts)\n        // viewport,                     // Bounds of the viewport in 3d units + factor (size/viewport)\n        // aspect,                       // Aspect ratio (size.width / size.height)\n        // mouse,                        // Current 2D mouse coordinates\n        // clock,                        // THREE.Clock (useful for useFrame deltas)\n        // invalidate,                   // Invalidates a single frame (for <Canvas invalidateFrameloop />)\n        // intersect,                    // Calls onMouseMove handlers for objects underneath the cursor\n        // setDefaultCamera,             // Sets the default camera\n    } = useThree();\n\n    gl.setClearColor(0x000000);\n    gl.shadowMap.enabled = true;\n    gl.shadowMap.type = THREE.PCFSoftShadowMap;\n\n    return (<>\n\n    </>)\n}\n\nexport const Controls = () => {\n    const orbitRef: any = useRef();\n\n    const { camera, gl }: any = useThree()\n    const setControls = useSampleStates(state => state.setControls)\n\n    useFrame(() => {\n        orbitRef.current.update();\n    })\n\n    useEffect(() => {\n        setControls(orbitRef.current)\n\n    }, []);\n\n    return (\n        <>\n            <orbitControls ref={orbitRef} args={[camera, gl.domElement]} enableDamping dampingFactor={0.1} rotateSpeed={0.5} />\n        </>\n    )\n};\n\nexport const MoveCtrl =\n    // React.forwardRef(({ onChange, object }, objectRef) => {\n    ({ onChange, object }: any) => {\n        const controls = useSampleStates(state => state.controls);\n        const transfCtrl: any = useRef();\n        const { camera, gl }: any = useThree();\n\n        const onMove = (event: any) => {\n            if (onChange)\n                onChange(event.target.object.matrix)\n        }\n\n        useEffect(() => {\n            // disable dragging for main controls\n            transfCtrl.current.addEventListener('dragging-changed', (event: any) =>\n                controls.enabled = !event.value);\n            console.log(\"attach controled object\");\n            transfCtrl.current.attach(object);\n            transfCtrl.current.addEventListener('dragging-changed', onMove);\n\n        }, []);\n\n        // cleanup effect hook\n        useEffect(() => () => {\n            console.log(\"detach controled object\");\n            transfCtrl.current.detach();\n            transfCtrl.current.removeEventListener('dragging-changed', onMove);\n        }, []);\n\n        return <transformControls ref={transfCtrl} args={[camera, gl.domElement]} />\n    }//)\n\n\nexport const Lights = (props: any) => {\n    const lt: any = useRef();\n\n    useFrame((state) => {\n        const time = state.clock.getElapsedTime();\n        // mesh.current.rotation.y += 0.01;\n        lt.current.position.x = 50 * Math.sin(time / 2);\n        lt.current.position.z = 50 * Math.cos(time / 2);\n    });\n\n    return (<>\n        <spotLight ref={lt} intensity={1} position={[30, 30, 50]} angle={0.2} penumbra={1} castShadow />\n    </>)\n}\n\nexport const Helpers = (props: any) => {\n    return (<>\n        <gridHelper args={[props.size, 10]} />\n        <axesHelper args={[props.size / 2]} />\n    </>)\n}\n\nconst Static = () => {\n    var grp = [];\n\n    var plane = <mesh rotation-x={Math.PI / 2} receiveShadow>\n        <planeGeometry attach=\"geometry\" args={[50, 50]} />\n        <Material name={CATALOG.SAND} repeat={1} />\n    </mesh>\n\n    grp.push(plane);\n\n    return (<>\n        <group>{grp}</group>;\n    </>)\n}\n\nconst Moveable = () => {\n    const [isSelected, setIsSelected] = useState(false);\n    const isSelectedRef: any = useRef();\n    const cubeRef: any = useRef();\n\n    const onClick = useCallback(\n        e => {\n            e.stopPropagation();\n            setIsSelected(!isSelectedRef.current);\n        },\n        []\n    );\n\n    useEffect(() => { isSelectedRef.current = isSelected });\n\n    const cubeMesh = useMemo(() => <mesh\n        ref={cubeRef}\n        position={[0, 0, 0]}\n        castShadow\n        onClick={e => onClick(e)}\n    //   onPointerOver={e => onHover(e, true)}\n    //   onPointerOut={e => onHover(e, false)}\n    >\n        <boxBufferGeometry attach=\"geometry\" args={[10, 10, 10]} />\n        <Material name={CATALOG.SAND} repeat={1} />\n    </mesh>, [])\n\n    // assign move control if object is selected\n    const moveCtrl = isSelected ? <MoveCtrl onChange={null} object={cubeRef.current} /> : \"\";\n\n    return (<>\n        {cubeMesh}\n        {moveCtrl}\n    </>)\n}\n\nexport default ({ sample }: any) => {\n\n    return (\n        <>\n            <InfoOverlay sample={sample} />\n            <Canvas gl2 camera={{ position: [15, 30, 50] }}\n            // onCreated={({ gl }) => ((gl.shadowMap.enabled = true), (gl.shadowMap.type = THREE.PCFSoftShadowMap))}>\n            >\n                <Wrapper />\n                <Lights />\n                <Helpers size={128} />\n                <Controls />\n                <Static />\n                <Moveable />\n            </Canvas>\n        </>\n    )\n};","module.exports = __webpack_public_path__ + \"static/media/sand.be1ebb92.jpg\";","module.exports = __webpack_public_path__ + \"static/media/sand_norm.3d153e6a.png\";","import React, {\n  useRef,\n  useState,\n  useEffect,\n} from \"react\";\nimport { Box3, Vector3, Color } from \"three\";\nimport { MoveCtrl } from \"../../samples/BasicDemo\";\n\nexport type BoxStyle = {\n  color: string,\n  alpha: number,\n  ghostColor: string,\n  ghostAlpha: number\n}\n\nexport type BoxEntity = {\n  box: Box3,\n  selected: Boolean\n}\n\nexport enum BOX_SELECT_MODES {\n  SINGLE,\n  MULTI,\n  DRAG,\n  DRAGMULTI,\n  ALLORNOT\n}\n\nconst defaultStyle = {\n  default: {\n    color: 'white',\n    alpha: 0.2,\n    ghostColor: 'white',\n    ghostAlpha: 0\n  },\n  hovered: {            // only affects unselected box\n    color: 'white',   // box color seems to have no impact here\n    alpha: 0.5,\n    ghostColor: 'brown',\n    ghostAlpha: 0.2\n  },\n  selected: {\n    color: 'orange',\n    alpha: 0.8,\n    ghostColor: 'green',\n    ghostAlpha: 0.4\n  }\n}\n\nexport const BoxEntityCtrlHlp = ({ boxEnt, onClick = () => { }, onChange = () => { }, boxStyle = defaultStyle }:\n  { boxEnt: BoxEntity, onClick?: any, onChange?: any, boxStyle?: any }) => {\n  const [isHovered, setIsHovered] = useState(true);\n  const boxRef: any = useRef();\n  const ghostRef: any = useRef();\n\n  const boxDim: any = new Vector3()\n  boxEnt.box.getSize(boxDim);\n  const boxCenter: any = new Vector3()\n  boxEnt.box.getCenter(boxCenter);\n\n  var style = { ...defaultStyle };\n  Object.assign(style, boxStyle); // fill missing custom style properties if provided\n\n  // color\n  const color = boxEnt.selected ? style.selected.color : style.default.color;\n  const alpha = boxEnt.selected ? style.selected.alpha : isHovered ? style.hovered.alpha : style.default.alpha;\n  const ghostColor = boxEnt.selected ? style.selected.ghostColor : style.default.ghostColor;\n  const ghostAlpha = boxEnt.selected ? style.selected.ghostAlpha : isHovered ? style.hovered.ghostAlpha : style.default.ghostAlpha;\n\n  // Events\n  const onHover = //useCallback(\n    (e: any, enabled: any) => {\n      e.stopPropagation();\n      setIsHovered(enabled);\n    }//,[isHovered]);\n\n  useEffect(() => {\n    boxRef.current.setFromObject(ghostRef.current);\n  })\n  const moveCtrl = boxEnt.selected && ghostRef.current ? <MoveCtrl /*ref={ghostRef}*/ onChange={onChange} object={ghostRef.current} /> : \"\";\n\n\n  return (\n    <>\n      <boxHelper ref={boxRef} >\n        <lineBasicMaterial attach='material' color={new Color(color)} transparent opacity={alpha} />\n      </boxHelper>\n      <mesh ref={ghostRef} attach=\"object\"\n        // visible={ghostAlpha > 0}\n        position={boxCenter}\n        onPointerUp={e => onClick(e)}\n        onPointerOver={e => onHover(e, true)}\n        onPointerOut={e => onHover(e, false)}\n        onWheel={() => console.log(\"wheel\")}\n      >\n        <boxBufferGeometry attach=\"geometry\" args={boxDim.toArray()} />\n        <meshStandardMaterial\n          attach=\"material\"\n          color={ghostColor}\n          transparent\n          opacity={ghostAlpha}\n        />\n      </mesh>\n      {moveCtrl}\n    </>\n  );\n};\n","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","import { Box3, Vector3 } from 'three';\n\nexport class BoxSplitter {\n\n    rejected = [];\n    static rejected: any;\n\n    static checkValidity(combination: any[], targetVol: number) {\n        var volume = combination.reduce((sizeSum: number, box: Box3) => {\n            var size = new Vector3();\n            box.getSize(size);\n            return sizeSum + size.x * size.y * size.z;\n        }, 0);\n        if (Math.round(volume) === Math.round(targetVol)) {\n            return combination;\n        }\n        else {\n            // console.log(\"Discard volume\");\n            // store.dispatch({ type: \"DEBUG\", subtype: \"STORE_VAL\", key: \"boxCombination\", val: grp });\n            if (!this.rejected) this.rejected = [];\n            if (BoxSplitter.checkDuplicate(combination, this.rejected)) {\n                this.rejected.push(combination);\n            }\n            return null;\n        }\n    }\n\n    static makeCombinations(combination: any[],\n        candidates: any[],\n        volumeTarget: any,\n        level: number): Box3[] | null {\n        var valid = candidates.filter((box: any) => {\n            // remove overlapping boxes\n            var index = combination.findIndex((box2: Box3) => {\n                return box2.containsBox(box) || box2.clone().expandByScalar(-0.01).intersectsBox(box);\n            });\n            return index === -1;\n        });\n        if (valid && valid.length) {\n            var validBoxes: Box3[] | null = [];\n            var validBox = valid.find((box: any, i: any) => {\n                // if(level <= 2) console.log(\"level \"+level+\" testing box \"+i+\"/\"+valid.length);\n                validBoxes = BoxSplitter.makeCombinations([...combination, box], valid, volumeTarget, level + 1);\n                return validBoxes !== null;\n            });\n            return validBox ? [validBox, ...validBoxes] : null;\n        } else if (this.checkValidity(combination, volumeTarget)) {\n            return [];  // working case\n        } else {\n            return null;    // non working case\n        }\n    }\n\n    static checkIntersections(intersectBox: Box3) {\n        var size = new Vector3(0);\n        intersectBox.getSize(size);\n        // intersects only if all size are not null\n        return Math.min(...size.toArray());\n    }\n\n    static checkDuplicate(combination: any[], combinationArr: any[]) {\n        var duplicate = combinationArr.find((combin2: any[]) => {\n            var dupe = true;\n            combination.forEach((box: any) => {\n                var found = combin2.find((box2: { equals: (arg0: any) => any; }) => { return box2.equals(box) });\n                dupe = dupe && found;\n            });\n            return dupe;\n        })\n        return !duplicate;\n    }\n\n    // getBoxSplitLayout\n    static split(box: Box3, intersectBoxes: Box3[]) {\n        // check inputs\n        var notOverlapping = intersectBoxes.filter(overlapBox => !box.intersectsBox(overlapBox));\n        if (notOverlapping.length) {\n            console.log(\"NOT all boxes are overlapping => don't go further\");\n            return [];\n        } else {\n            var boxPtsArr = [box, ...intersectBoxes].map((box) => {\n                var pts = [];\n                pts.push(box.min.clone());\n                pts.push(new Vector3(box.max.x, box.min.y, box.min.z));\n                pts.push(new Vector3(box.max.x, box.min.y, box.max.z));\n                pts.push(new Vector3(box.min.x, box.min.y, box.max.z));\n                pts.push(new Vector3(box.min.x, box.max.y, box.min.z));\n                pts.push(new Vector3(box.max.x, box.max.y, box.min.z));\n                pts.push(box.max.clone());\n                pts.push(new Vector3(box.min.x, box.max.y, box.max.z));\n                return pts;\n            });\n\n            var boxPts: Vector3[] = boxPtsArr.flat().reduce((arr: Vector3[], p: Vector3) => {\n                var index = arr.findIndex((p2: any) => { return p.equals(p2) });\n                if (index === -1) return [...arr, p];\n                else {\n                    arr.splice(index, 1);\n                    return arr;\n                }\n            }, []);\n            var boxes: Box3[] = [];\n            boxPts.forEach((p, i) => {\n                var candidates = boxPts.slice(i).filter((p2) => {\n                    return (p.x !== p2.x && p.y !== p2.y && p.z !== p2.z);\n                });\n                candidates.forEach((p2) => {\n                    var box = new Box3();\n                    box.expandByPoint(p);\n                    box.expandByPoint(p2);\n                    var invalid = intersectBoxes.find((box2: Box3) => {\n                        return box.intersectsBox(box2.clone().expandByScalar(-0.1));\n                    });\n                    if (!invalid) boxes.push(box);\n                });\n            });\n\n            var size = new Vector3();\n            box.getSize(size);\n            var vol = size.x * size.y * size.z;\n            var emptySpace = intersectBoxes.reduce((volDiff: number, box: Box3) => {\n                box.getSize(size);\n                return volDiff - size.x * size.y * size.z;\n            }, vol);\n\n            var combinationCandidates: any[] = [];\n            boxes.forEach((box) => {\n                var combin = BoxSplitter.makeCombinations([box], boxes, emptySpace, 0);\n                if (combin) {\n                    combin = [box, ...combin];\n                    if (BoxSplitter.checkDuplicate(combin, combinationCandidates)) {\n                        combinationCandidates.push(combin);\n                    }\n                }\n            })\n            combinationCandidates.sort((g1, g2) => {\n                return (g1.length - g2.length)\n            })\n\n            var res = combinationCandidates[0];\n            if (!res) {\n                console.log(\"WARN No split found for intersection of \");\n                console.log(box)\n                console.log(\"with boxes: \");\n                console.log(intersectBoxes)\n                console.log(\"DEBUG => rejected combination:\");\n                console.log(this.rejected);\n                // return this.rejected;\n                return null;\n            }\n            return res;\n        }\n    }\n\n    static getRejected() {\n        return this.rejected;\n    }\n}","///<reference path=\"../dts/misc-types-extend.d.ts\" />\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { Box3, Vector3, Matrix4 } from \"three\";\nimport { BoxSplitter } from \"../modules/tools/BoxUtils\";\nimport { useFrame, useThree, Canvas } from \"react-three-fiber\";\nimport { BoxEntityCtrlHlp } from \"../modules/helpers/BoxEntityCtrlHlp\";\nimport { useSampleStates } from \"../common/states\";\nimport { InfoOverlay } from \"../modules/UI/Overlay\";\nimport { Controls, Wrapper } from \"./BasicDemo\";\n\n\nconst StaticBoxStyle = {\n    default: {\n        color: \"white\",\n        alpha: 0.4,\n        ghostColor: \"white\",\n        ghostAlpha: 0\n    },\n    hovered: {\n        color: \"orange\",\n        alpha: 0.4,\n        ghostColor: \"white\",\n        ghostAlpha: 0\n    }\n}\n\nconst MovingBoxStyle = {\n    selected: {\n        color: \"white\",\n        alpha: 0.6,\n        ghostColor: \"white\",\n        ghostAlpha: 0.1\n    }\n}\n\nconst OverlapBoxStyle = {\n    default: {\n        color: \"red\",\n        alpha: 1,\n        ghostColor: \"red\",\n        ghostAlpha: 0.1\n    }\n}\n\nconst SplitBoxesStyle = {\n    default: {\n        color: \"green\",\n        alpha: 1,\n        ghostColor: \"green\",\n        ghostAlpha: 0.1\n    }\n}\n\nconst orig = new Vector3(0, 0, 0);\nvar orig2 = new Vector3(20, 30, 40);\nconst dim = new Vector3(50, 50, 50);\nconst dim2 = new Vector3(51, 51, 25);\nconst staticBox = new Box3(orig, dim);\nconst movingBox = new Box3(orig2, orig2.clone().add(dim2));\n\nconst AnimationWidget = () => {\n    const time = useSampleStates(state => state.time);\n    const setTime = useSampleStates(state => state.setTime);\n\n    // init time state\n    useEffect(() => {\n        setTime(new Date(0))\n    }, [])\n\n    return (<>\n        {time.custom ? <span className=\"overlay\" id=\"timeinfo\">Custom Time (SPACE key to toggle anim) {time.custom.toLocaleTimeString()}  </span> : \"\"}\n    </>)\n}\n\nconst Main = () => {\n\n    const time = useSampleStates(state => state.time);\n    const setTime = useSampleStates(state => state.setTime);\n    // convert to minutes:\n    const clk = useThree().clock;\n    const anim = useRef(false);\n\n    const [splitBoxes, setSplitBoxes]: any = useState([]);\n\n    const staticBoxEnt = {\n        box: staticBox,\n        selected: false\n    }\n\n    const movingBoxEnt = {\n        box: movingBox,\n        selected: true,\n    }\n\n    const onMove = (mat: Matrix4) => {\n        var movingBox = movingBoxEnt.box;\n        const boxDim: any = new Vector3(0, 0, 0);\n        movingBox.getSize(boxDim);\n        const boxCenter: any = new Vector3()\n        boxCenter.applyMatrix4(mat);\n        movingBoxEnt.box.setFromCenterAndSize(boxCenter, boxDim);\n        if (movingBox.intersectsBox(staticBox)) {\n            var overlapBox = movingBox.clone().intersect(staticBox);\n            var splitBoxes = BoxSplitter.split(staticBox, [overlapBox]);\n            setSplitBoxes([overlapBox, ...splitBoxes]);\n        }\n        return {};\n    }\n\n    useFrame(() => {\n        var realTime = clk.getElapsedTime(); //Math.round(clk.getElapsedTime() * 100);\n        var date = new Date(0);\n        date.setHours(Math.floor(realTime) % 24);\n        date.setMinutes(Math.floor((realTime - Math.floor(realTime)) * 60))\n        if (anim.current) {\n            setTime(date);\n        }\n    })\n\n    useEffect(() => {\n        var mat = new Matrix4()\n        const statBoxCenter = new Vector3(0, 0, 0);\n        staticBox.getCenter(statBoxCenter);\n        const movBoxCenter = new Vector3(0, 0, 0);\n        movingBox.getCenter(movBoxCenter);\n        var t = time.custom.getHours() * 60 + time.custom.getMinutes();\n        var tmax = 24 * 60;\n        mat.makeTranslation(statBoxCenter.x / 2 * (1 + Math.cos(2 * Math.PI * t / tmax) * 2),\n            25 * (1 + Math.sin(2 * Math.PI * t / tmax) * 2),\n            movBoxCenter.z);\n        onMove(mat);\n    }, [time]);\n\n    useEffect(() => {\n        // Start/Stop animation\n        window.addEventListener('keydown', (evt) => {\n            if (evt.code === \"Space\")\n                anim.current = !anim.current;\n        }, false);\n    }, [])\n\n    const helpers = [<BoxEntityCtrlHlp key={0} boxEnt={staticBoxEnt} boxStyle={StaticBoxStyle} />,\n    <BoxEntityCtrlHlp key={1} boxEnt={movingBoxEnt} onChange={onMove} boxStyle={MovingBoxStyle} />];\n\n    const splitBoxHelpers = splitBoxes.map((box: Box3, i: number) => {\n        var ent = {\n            box: box,\n            selected: false\n        };\n        var style = i ? SplitBoxesStyle : OverlapBoxStyle\n        return <BoxEntityCtrlHlp key={i + 2} boxEnt={ent} boxStyle={{ ...style }} />\n    })\n\n    return (<>\n        {helpers}\n        {splitBoxHelpers}\n    </>)\n}\n\n\nexport default ({ sample }: any) => {\n    return (<>\n        <AnimationWidget />\n        <InfoOverlay sample={sample} />\n        <Canvas camera={{ position: [100, 50, 100] }}>\n            <ambientLight intensity={0.5} />\n            <Wrapper />\n            <Controls />\n            <Main />\n        </Canvas>\n    </>)\n};"],"sourceRoot":""}